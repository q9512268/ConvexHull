package de.feu.propra18.q9512268.gui.controller;

import java.io.File;
import java.io.IOException;
import java.net.URL;
import java.util.ResourceBundle;

import de.feu.propra18.q9512268.app.main.MainFacade;
import de.feu.propra18.q9512268.gui.util.Properties;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.fxml.Initializable;
import javafx.scene.Scene;
import javafx.scene.control.MenuBar;
import javafx.scene.control.MenuItem;
import javafx.stage.FileChooser;
import javafx.stage.Stage;

public class MenuController implements Initializable {

	private MainFacade FACADE;

	private MainController mainController;

	@FXML
	private MenuBar menu_bar;
	@FXML
	private MenuItem menu_file_open;
	@FXML
	private MenuItem menu_file_save;
	@FXML
	private MenuItem menu_file_save_as;
	@FXML
	private MenuItem menu_file_new;
	@FXML
	private MenuItem menu_help_manual;

	private static String savedPath;

	@Override
	public void initialize(URL location, ResourceBundle resources) {

		FACADE = MainFacade.get_Instance();
		FileChooser fileChooser = FACADE.get_FileChooser();

		menu_file_save.setDisable(true);

		menu_file_new.setOnAction((e) -> {
			menu_file_save.setDisable(true);
			savedPath = null;
			mainController.clearPolygon();
			mainController.initPolygon();
			FACADE.clear_Container();

		});

		menu_file_open.setOnAction((e) -> {
			File file = fileChooser.showOpenDialog(menu_bar.getScene().getWindow());
			if (file != null) {
				FACADE.clear_Container();
				FACADE.add_PointsFromFile(file.getAbsolutePath(), "menu_file_open");
				FACADE.calculate_PointsConvexHull();
				menu_file_save.setDisable(false);
				savedPath = file.getAbsolutePath();
			}
		});

		menu_file_save.setOnAction((e) -> {
			FACADE.save_PointsToFile(savedPath);
		});

		menu_file_save_as.setOnAction((e) -> {
			fileChooser.setInitialDirectory(new File(System.getProperty("user.home")));
			fileChooser.setTitle(Properties.getString("SAVE_POINTS"));
			fileChooser.setInitialFileName(Properties.getString("INITIAL_POINTS_FILE_NAME"));
			File file = fileChooser.showSaveDialog(menu_bar.getScene().getWindow());
			if (file != null) {
				FACADE.save_PointsToFile(file.getAbsolutePath());
				menu_file_save.setDisable(false);
				savedPath = file.getAbsolutePath();

			}
		});

		menu_help_manual.setOnAction((e) -> {
			try {
				FXMLLoader fxmlLoader = new FXMLLoader(getClass().getResource(Properties.getString("MANUAL_FXML")));
				fxmlLoader.setController(new ManualController());

				Stage stage = new Stage();
				Scene scene = new Scene(fxmlLoader.load(), 600, 700);
				stage.setScene(scene);
				stage.setTitle(Properties.getString("MANUAL"));
				stage.show();
			} catch (IOException ex) {
				ex.printStackTrace();
			}
		});

	}

	public void setMainController(MainController mainController) {
		this.mainController = mainController;

	}
}
